Estoy intentando imputar por similitud de nombre el código CIIU por medio del siguiente código en R

## imputacion por nombre

library(dplyr)

# Función para obtener la moda solo si representa mayoría
moda_con_mayoria <- function(x, umbral = 0.05) {
  x <- na.omit(x)
  if (length(x) == 0) return(NA)
  tab <- table(x)
  moda <- names(tab)[which.max(tab)]
  prop <- max(tab) / sum(tab)
  if (prop >= umbral) return(moda) else return(NA)
}

# Aplicar imputación con control de mayoría
proveedores_ciiu_imputado2 <- proveedores_ciiu_imputado %>%
  mutate(nombre_base = word(MCOD_1, 1, 3)) %>%
  group_by(nombre_base) %>%
  mutate(
    moda_valor = moda_con_mayoria(CIIU_final, umbral = 0.05),
    CIIU_final = if_else(is.na(CIIU_final), moda_valor, CIIU_final)
  ) %>%
  ungroup() %>%
  select(-nombre_base, -moda_valor)

Pero veo que no lo hace como yo quiera, pues en este ejemplo debería imputarse el 4661 que es el que mas se repite de los nombres similares del grupo TRAFIGURA, pero esta poniendo un 10 y un NA

MCOD_1	ANTES	CIIU_final
TRAFIGURA ENVIRONMENTAL S	NA	NA
TRAFIGURA TRADING LLC	4669	4669
TRAFIGURA SECURITISATION	NA	10
TRAFIGURA MARITIME LOGIST	6412	6412
TRAFIGURA PTE LTD	4290	4290
C.I. TRAFIGURA PETROLEUM	4661	4661
TRAFIGURA ENERGY COLOMBIA	4661	4661
TRAFIGURA MARKETING COLOM	4661	4661

como lo resuelvo
